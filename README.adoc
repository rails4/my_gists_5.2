# https://gists52.herokuapp.com/[My Gists 5.2 with Comments]
:toc!:

The second model will handle comments on gists.

### 6.1 Generating a Model

```sh
bin/rails generate model Comment commenter:string body:text gist:references
# check generated files models/comments.rb and migration
bin/rails db:migrate
```

### 6.2 Associating Models

* Each comment belongs to one gist.
* One gist can have many comments.

```ruby
class Gist < ApplicationRecord
  has_many :comments
  validates :src, presence: true, length: { minimum: 8, maximum: 256 }
end
```

### 6.3 Adding a Route for Comments

Update _config/routes.rb_.

```ruby
resources :gist do
  resources :comments
end
```

Check routing.

```sh
rails routes
```

### 6.4 Generating a Controller

```ruby
bin/rails generate controller Comments
```

Users will create their comments directly after reading the gist, and once
they have added their comment, will be sent back to the gist show page to see
their comment now listed.

_CommentsController_ is there to provide a method to create comments and
delete spam comments when they arrive.

First update the _Gist_ show template.

```html
<h2>Add a comment</h2>
<%= form_for([@gist, @gist.comments.build]) do |f| %>
  <p><%= f.label :commenter %><br><%= f.text_field :commenter %></p>
  <p><%= f.label :body %><br><%= f.text_area :body %></p>
  <p><%= f.submit %></p>
<% end %>
```

Now, wire up the create in _comments_controller.rb_.

```ruby
class CommentsController < ApplicationController
  def create
    @gist = Gist.find(params[:gist_id])
    @comment = @gist.comments.create(comment_params)
    redirect_to gist_path(@gist)
  end

  private

  def comment_params
    params.require(:comment).permit(:commenter, :body)
  end
end
```

Update one more _Gist_ show template.

```html
<% @gist.comments.each do |comment| %>
  <p><strong>Commenter:</strong><%= comment.commenter %></p>
  <p><strong>Comment:</strong><%= comment.body %></p>
<% end %>
```
